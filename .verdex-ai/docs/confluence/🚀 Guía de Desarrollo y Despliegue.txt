ğŸš€ GUÃA DE DESARROLLO Y DESPLIEGUE
ğŸ“‹ SETUP DEL ENTORNO DE DESARROLLO
âœ… Prerrequisitos


# Herramientas requeridas
- Docker & Docker Compose v2.0+
- Flutter SDK 3.6.0+
- Git
- VS Code (recomendado)
ğŸ”§ InstalaciÃ³n RÃ¡pida


# 1. Clonar repositorio
git clone <repository-url>
cd asistente-voz-realtime
# 2. Levantar servicios backend
docker-compose up -d
# 3. Verificar servicios
docker-compose ps
# 4. Configurar Flutter app
cd audio_recorder_app
flutter pub get
flutter run
ğŸ—ï¸ ESTRUCTURA DEL PROYECTO
OrganizaciÃ³n de Directorios


asistente-voz-realtime/
â”œâ”€â”€ ğŸ“± audio_recorder_app/          # Flutter App
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ main.dart               # Entry point
â”‚   â”‚   â”œâ”€â”€ models/                 # Data models
â”‚   â”‚   â”œâ”€â”€ providers/              # State management
â”‚   â”‚   â”œâ”€â”€ screens/                # UI screens
â”‚   â”‚   â”œâ”€â”€ services/               # Business logic
â”‚   â”‚   â””â”€â”€ widgets/                # Reusable components
â”‚   â”œâ”€â”€ assets/config/              # Configuration files
â”‚   â””â”€â”€ pubspec.yaml                # Dependencies
â”œâ”€â”€ âš™ï¸ backend/                     # FastAPI Backend
â”‚   â”œâ”€â”€ fastapi_app/
â”‚   â”‚   â””â”€â”€ main.py                 # API endpoints
â”‚   â”œâ”€â”€ requirements.txt            # Python dependencies
â”‚   â””â”€â”€ Dockerfile                  # Container config
â”œâ”€â”€ ğŸ³ docker-compose.yml           # Services orchestration
â”œâ”€â”€ ğŸ“š README.md                    # Project documentation
â””â”€â”€ ğŸŒ³ git-branch-strategy.md       # Git workflow
ğŸ”§ CONFIGURACIÃ“N DETALLADA
1. ConfiguraciÃ³n de Red Local


// audio_recorder_app/assets/config/config.json
{
  "env": "dev",
  "backend_url": "http://192.168.1.10:5005",     // âš ï¸ Cambiar IP
  "n8n_webhook": "http://192.168.1.10:5678/webhook/audio",
  "mqtt_host": "192.168.1.10",                   // âš ï¸ Cambiar IP
  "mqtt_port": 1883,
  "mqtt_topic": "audios/demo",
  "user_id": "single-user",
  "max_recording_duration_sec": 300,
  "auto_upload": true,
  "delete_after_upload": true
}
ğŸ” CÃ³mo encontrar tu IP:



# Linux/Mac
ip addr show | grep inet
# Windows
ipconfig
# Usar en config.json la IP de tu mÃ¡quina de desarrollo
2. Variables de Entorno Backend


# docker-compose.yml - ConfiguraciÃ³n automÃ¡tica
environment:
  - MONGODB_URL=mongodb://mongo:27017/
  - MONGODB_DB=audio_productivity
  - UPLOAD_DIR=/app/audios
  - WHISPER_MODEL=base                    # tiny, base, small, medium, large
  - N8N_WEBHOOK_URL=http://n8n:5678/webhook/audio
3. ConfiguraciÃ³n Flutter


# pubspec.yaml - Dependencias principales
dependencies:
  flutter_sound: ^9.2.13          # Audio recording
  dio: ^5.4.0                     # HTTP client
  mqtt_client: ^10.0.0            # MQTT communication
  provider: ^6.1.1                # State management
  permission_handler: ^11.3.1     # Device permissions
ğŸš€ COMANDOS DE DESARROLLO
Backend (Docker)


# Levantar todos los servicios
docker-compose up -d
# Ver logs en tiempo real
docker-compose logs -f fastapi-backend
# Reiniciar un servicio especÃ­fico
docker-compose restart fastapi-backend
# Parar todos los servicios
docker-compose down
# Limpiar volÃºmenes (âš ï¸ borra datos)
docker-compose down -v
Flutter App


# Instalar dependencias
flutter pub get
# Ejecutar en debug
flutter run
# Ejecutar en dispositivo especÃ­fico
flutter devices
flutter run -d <device-id>
# Build para release
flutter build apk
flutter build ios
Desarrollo con Hot Reload


# Terminal 1: Backend services
docker-compose up
# Terminal 2: Flutter app
cd audio_recorder_app
flutter run
# Los cambios en Flutter se reflejan automÃ¡ticamente
# Para cambios en backend, reiniciar container
ğŸ” DEBUGGING Y TROUBLESHOOTING
Problemas Comunes
1. App no conecta al backend


# Verificar que el backend estÃ© corriendo
curl http://192.168.1.10:5005/health
# Verificar IP en config.json
cat audio_recorder_app/assets/config/config.json
# Verificar firewall (Linux)
sudo ufw status
sudo ufw allow 5005
2. Error de permisos de audio


// En Android, verificar permisos en AndroidManifest.xml
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
// En iOS, verificar Info.plist
<key>NSMicrophoneUsageDescription</key>
<string>Esta app necesita acceso al micrÃ³fono para grabar audio</string>
3. MQTT no conecta


# Verificar EMQX dashboard
http://192.168.1.10:18083
# Usuario: admin, Password: public
# Test MQTT connection
docker exec -it audio-emqx emqx_ctl status
4. Whisper model no carga


# Verificar logs del backend
docker-compose logs fastapi-backend
# El modelo se descarga automÃ¡ticamente en el primer uso
# Puede tardar varios minutos la primera vez
Logs Ãštiles


# Backend API logs
docker-compose logs -f fastapi-backend
# MongoDB logs
docker-compose logs -f mongo
# n8n logs
docker-compose logs -f n8n
# EMQX logs
docker-compose logs -f emqx
# Flutter logs (en consola durante flutter run)
flutter logs
ğŸ§ª TESTING
Testing Backend


# Health check
curl http://192.168.1.10:5005/health
# Upload test (con archivo de audio)
curl -X POST http://192.168.1.10:5005/upload-audio \
  -F "audio=@test_audio.aac" \
  -F "user_id=test-user"
# Ver grabaciones
curl http://192.168.1.10:5005/recordings/test-user
Testing Flutter


# Unit tests
flutter test
# Integration tests
flutter test integration_test/
# Widget tests
flutter test test/widget_test.dart
Testing MQTT


# Suscribirse a topic (usando mosquitto-clients)
mosquitto_sub -h 192.168.1.10 -t "audios/demo"
# Publicar mensaje de prueba
mosquitto_pub -h 192.168.1.10 -t "audios/demo" -m "test message"
ğŸ“¦ DESPLIEGUE EN PRODUCCIÃ“N
1. ConfiguraciÃ³n de ProducciÃ³n


// config.json para producciÃ³n
{
  "env": "prod",
  "backend_url": "https://api.tu-dominio.com",
  "n8n_webhook": "https://n8n.tu-dominio.com/webhook/audio",
  "mqtt_host": "mqtt.tu-dominio.com",
  "mqtt_port": 8883,                    // SSL
  "show_debug_info": false
}
2. Docker Compose ProducciÃ³n


# docker-compose.prod.yml
version: '3.8'
services:
  fastapi-backend:
    build: ./backend
    environment:
      - ENV=production
      - MONGODB_URL=mongodb://mongo:27017/
      - WHISPER_MODEL=small              # Mejor precisiÃ³n
    restart: always
  nginx:                                # Reverse proxy
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/ssl
3. Build Flutter para ProducciÃ³n


# Android APK
flutter build apk --release
# Android App Bundle (para Google Play)
flutter build appbundle --release
# iOS (requiere Mac + Xcode)
flutter build ios --release
4. ConfiguraciÃ³n SSL/HTTPS


# nginx.conf
server {
    listen 443 ssl;
    server_name api.tu-dominio.com;
    ssl_certificate /etc/ssl/cert.pem;
    ssl_certificate_key /etc/ssl/key.pem;
    location / {
        proxy_pass http://fastapi-backend:5005;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
ğŸ”„ CI/CD Pipeline
GitHub Actions (Ejemplo)


# .github/workflows/deploy.yml
name: Deploy
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.6.0'
      - name: Build Flutter
        run: |
          cd audio_recorder_app
          flutter pub get
          flutter test
          flutter build apk --release
      - name: Deploy Backend
        run: |
          docker-compose -f docker-compose.prod.yml up -d
ğŸ“Š MONITOREO EN PRODUCCIÃ“N
Health Checks


# Script de monitoreo
#!/bin/bash
# health_check.sh
BACKEND_URL="https://api.tu-dominio.com"
# Check backend
if curl -f $BACKEND_URL/health > /dev/null 2>&1; then
    echo "âœ… Backend OK"
else
    echo "âŒ Backend DOWN"
    # Enviar alerta
fi
# Check services
docker-compose ps --format "table {{.Name}}\t{{.Status}}"
Logs Centralizados


# docker-compose.yml con logging
services:
  fastapi-backend:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
ğŸ”— RECURSOS Y ENLACES
DocumentaciÃ³n TÃ©cnica
API Docs: http://localhost:5005/docs

Swagger UI: http://localhost:5005/redoc

EMQX Dashboard: http://localhost:18083

n8n Interface: http://localhost:5678

Herramientas de Desarrollo
Flutter DevTools: flutter pub global activate devtools

MongoDB Compass: GUI para MongoDB

MQTT Explorer: Cliente MQTT visual

Postman: Testing de APIs

Comandos Ãštiles


# Ver puertos ocupados
netstat -tulpn | grep :5005
# Limpiar Docker
docker system prune -a
# Ver uso de recursos
docker stats
# Backup MongoDB
docker exec audio-mongo mongodump --out /backup
Ãšltima actualizaciÃ³n: Julio 5, 2025  
GuÃ­a completa para desarrollo y despliegue v1.0